# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/
$ -> 
    $("tr[data-payment-detail]").click (view) ->
        view.preventDefault()
        option = $(this).data("payment-detail")
        get_ajax(option, '/dashboard/info/getpayment/')

$ ->
    $("a[data-painel-menu]").click (view) ->
        view.preventDefault()
        option = $(this).data("painel-menu")
        if option is "overview"
            get_ajax(option,'payments_details')
        else if option is "deposit"
            get_ajax(option,'/dashboard/info/getwallets')
        else
            get_ajax(option,'')

executeQuery = () ->
    if $(".current_place").prop("place") != "overview"
        $.get('/exchange/open_orders')
    else
        $.ajax '/exchange/open_orders',
                type: 'GET',
                dataType: "json"
                error: (jqXHR, textStatus, errorThrown) ->
                    console.log("AJAX Error: #{textStatus}")
                success: (data, textStatus, jqXHR) ->
                    <% EXCHANGE_PARES.each do |par| %>
                    <% atual = par.tr(" ", "") %>
                    <% obj = atual.tr("/","_") %>
                        $('.<%= obj %>_buy').html(data["<%= atual %>_buy"])
                        $('.<%= obj %>_sell').html(data["<%= atual %>_sell"])
                    <% end %>
                    

$ ->
    $.get('payments_details')
#    setInterval(executeQuery, 9000)

get_ajax = (route,callbackroute) -> 
    if callbackroute is ''
        $.ajax 'layouts/'+route,
                type: 'GET'
    else
        $.ajax 'layouts/'+route,
                type: 'GET'
                error: (jqXHR, textStatus, errorThrown) ->
                    $('body').append "AJAX Error: #{textStatus}"
                success: (data, textStatus, jqXHR) ->
                    $.ajax callbackroute, 
                        type: 'GET' 