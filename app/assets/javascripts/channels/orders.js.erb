//= require cable
//= require_self
//= require_tree .
//= require action_cable

this.App = {};

App.cable = ActionCable.createConsumer();  





App.orders = App.cable.subscriptions.create("OrdersChannel", {
  connected: function() {
    console.log("conected into websocket")
  },

  disconnected: function() {
    // Called when the subscription has been terminated by the server
  },

  received: function(data) {
    if ($(".current_place").prop("place") != "overview"){
        $.get('/exchange/open_orders')
    }else{
      $.ajax({
      url: ("/exchange/open_orders"),
      cache: false,
      dataType: "json",
      type: "GET",
      success: function(response) {
         <% EXCHANGE_PARES.each do |par| %>
                    <% atual = par.tr(" ", "") %>
                    <% obj = atual.tr("/","_") %>
                        $('.<%= obj %>_buy').html(data["<%= atual %>_buy"])
                        $('.<%= obj %>_sell').html(data["<%= atual %>_sell"])
                    <% end %> 
      },
      error: function(xhr) {
          
      }
      });
    }             
    // Called when there's incoming data on the websocket for this channel
  }
});
